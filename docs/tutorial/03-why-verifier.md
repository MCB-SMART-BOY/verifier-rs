# Á¨¨‰∏âÁ´†Ôºö‰∏∫‰ªÄ‰πàÈúÄË¶ÅÈ™åËØÅÂô®Ôºü

# Chapter 3: Why Do We Need a Verifier?

```
+-----------------------------------------------------------------------------------+
|                                                                                   |
|    ‚ñà‚ñà+   ‚ñà‚ñà+‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+ ‚ñà‚ñà+‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+‚ñà‚ñà+‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+                         |
|    ‚ñà‚ñà|   ‚ñà‚ñà|‚ñà‚ñà+----+‚ñà‚ñà+--‚ñà‚ñà+‚ñà‚ñà|‚ñà‚ñà+----+‚ñà‚ñà|‚ñà‚ñà+----+‚ñà‚ñà+--‚ñà‚ñà+                        |
|    ‚ñà‚ñà|   ‚ñà‚ñà|‚ñà‚ñà‚ñà‚ñà‚ñà+  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà++‚ñà‚ñà|‚ñà‚ñà‚ñà‚ñà‚ñà+  ‚ñà‚ñà|‚ñà‚ñà‚ñà‚ñà‚ñà+  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà++                        |
|    +‚ñà‚ñà+ ‚ñà‚ñà++‚ñà‚ñà+--+  ‚ñà‚ñà+--‚ñà‚ñà+‚ñà‚ñà|‚ñà‚ñà+--+  ‚ñà‚ñà|‚ñà‚ñà+--+  ‚ñà‚ñà+--‚ñà‚ñà+                        |
|     +‚ñà‚ñà‚ñà‚ñà++ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+‚ñà‚ñà|  ‚ñà‚ñà|‚ñà‚ñà|‚ñà‚ñà|     ‚ñà‚ñà|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà+‚ñà‚ñà|  ‚ñà‚ñà|                        |
|      +---+  +------++-+  +-++-++-+     +-++------++-+  +-+                        |
|                                                                                   |
|                    "With great power comes great responsibility"                  |
|                                                                                   |
|               BPF ‰ª£Á†ÅËøêË°åÂú®ÂÜÖÊ†∏‰∏≠ÔºåÊã•ÊúâÂ∑®Â§ßÁöÑÊùÉÂäõ„ÄÇ                              |
|               È™åËØÅÂô®Â∞±ÊòØÁ°Æ‰øùËøôÁßçÊùÉÂäõ‰∏çË¢´Êª•Áî®ÁöÑÂÆàÈó®‰∫∫„ÄÇ                            |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

## Êú¨Á´†ÁõÆÊ†á | Chapter Goals

Â≠¶ÂÆåËøôÁ´†Ôºå‰Ω†Â∞ÜÁêÜËß£Ôºö
- BPF Á®ãÂ∫èÂèØËÉΩÂ∏¶Êù•ÁöÑÂç±Èô©
- È™åËØÅÂô®ÈúÄË¶ÅÊ£ÄÊü•ÁöÑÂÆâÂÖ®Â±ûÊÄß
- ÊäΩË±°Ëß£ÈáäÁöÑÂü∫Êú¨ÂéüÁêÜ
- È™åËØÅÂô®Â¶Ç‰ΩïÊãíÁªù‰∏çÂÆâÂÖ®Á®ãÂ∫è

---

## Ê≤°ÊúâÈ™åËØÅÂô®‰ºöÊÄéÊ†∑Ôºü | What Without a Verifier?

ËÆ©Êàë‰ª¨ÁúãÁúãÔºåÂ¶ÇÊûúÊ≤°ÊúâÈ™åËØÅÂô®ÔºåÊÅ∂ÊÑèÁöÑ BPF Á®ãÂ∫èÂèØ‰ª•ÂÅö‰ªÄ‰πàÔºö

### Â®ÅËÉÅ 1ÔºöËØªÂèñ‰ªªÊÑèÂÜÖÂ≠ò | Arbitrary Memory Read

```
+-----------------------------------------------------------------------------------+
|                            ÊîªÂáªÔºöËØªÂèñÊïèÊÑüÊï∞ÊçÆ                                     |
|                        Attack: Reading Sensitive Data                             |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ÊÅ∂ÊÑè BPF ‰ª£Á†Å:                                                                  |
|   +-----------------------------------------------------------------------------+ |
|   |  mov r1, 0xffff8880deadbeef   // ‰∏Ä‰∏™ÂÜÖÊ†∏Âú∞ÂùÄ                               | |
|   |  ldxdw r0, [r1]               // ËØªÂèñËØ•Âú∞ÂùÄÁöÑÂÜÖÂÆπ                           | |
|   |  exit                          // ËøîÂõûÁªôÁî®Êà∑Á©∫Èó¥                            | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
|   ------------------------------------------------------------------------------- |
|                                                                                   |
|   ÂêéÊûú:                                                                           |
|                                                                                   |
|   +-----------------------------------------------------------------------------+ |
|   |                             ÂÜÖÊ†∏ÂÜÖÂ≠ò                                        | |
|   |                                                                             | |
|   |   +------------------+------------------+----------------------+            | |
|   |   |   Áî®Êà∑ÂØÜÁ†Å        |    SSH ÁßÅÈí•      |     Âä†ÂØÜÂØÜÈí•         |            | |
|   |   |                  |                  |                      |            | |
|   |   |  hunter123       |  -----BEGIN      |  0x1a2b3c4d...      |            | |
|   |   |  password123     |  RSA PRIVATE     |                      |            | |
|   |   |  qwerty          |  KEY-----        |                      |            | |
|   |   +--------+---------+--------+---------+----------+-----------+            | |
|   |            |                  |                    |                        | |
|   |            v                  v                    v                        | |
|   |   +---------------------------------------------------------------+         | |
|   |   |              üòà ÊÅ∂ÊÑè BPF Á®ãÂ∫èÂèØ‰ª•ËØªÂèñËøô‰∏ÄÂàáÔºÅ                 |         | |
|   |   |                                                               |         | |
|   |   |   ÊîªÂáªËÄÖÂèØ‰ª•:                                                 |         | |
|   |   |   ‚Ä¢ Á™ÉÂèñÂÖ∂‰ªñÁî®Êà∑ÁöÑÂØÜÁ†Å                                       |         | |
|   |   |   ‚Ä¢ Ëé∑Âèñ SSH ÂØÜÈí•ÁôªÂΩïÂÖ∂‰ªñÁ≥ªÁªü                                |         | |
|   |   |   ‚Ä¢ Ëß£ÂØÜÂä†ÂØÜÁöÑÊï∞ÊçÆ                                           |         | |
|   |   |   ‚Ä¢ ËØªÂèñ‰ªª‰ΩïÂÜÖÊ†∏Êï∞ÊçÆÁªìÊûÑ                                     |         | |
|   |   +---------------------------------------------------------------+         | |
|   |                                                                             | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

### Â®ÅËÉÅ 2ÔºöÂÜôÂÖ•‰ªªÊÑèÂÜÖÂ≠ò | Arbitrary Memory Write

```
+-----------------------------------------------------------------------------------+
|                            ÊîªÂáªÔºöÊùÉÈôêÊèêÂçá                                         |
|                        Attack: Privilege Escalation                               |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ÊÅ∂ÊÑè BPF ‰ª£Á†Å:                                                                  |
|   +-----------------------------------------------------------------------------+ |
|   |  // current->cred->uid Â≠òÂÇ®ÂΩìÂâçËøõÁ®ãÁöÑÁî®Êà∑ ID                                | |
|   |  mov r1, &current->cred->uid   // Ëé∑Âèñ UID ÁöÑÂú∞ÂùÄ                           | |
|   |  mov r2, 0                     // root ÁöÑ UID ÊòØ 0                          | |
|   |  stxw [r1], r2                 // ÊääËá™Â∑±ÂèòÊàê rootÔºÅ                         | |
|   |  exit                                                                       | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
|   ------------------------------------------------------------------------------- |
|                                                                                   |
|   ÊîªÂáªËøáÁ®ã:                                                                       |
|                                                                                   |
|   +-------------------------+         +-------------------------+                 |
|   |     ÊîªÂáªÂâç               |         |      ÊîªÂáªÂêé              |                 |
|   |                         |         |                         |                 |
|   |  struct cred {          |         |  struct cred {          |                 |
|   |    uid = 1000  <-----   |  --->   |    uid = 0  <-- root!   |                 |
|   |    gid = 1000        |  |         |    gid = 1000           |                 |
|   |    ...              ‰øÆÊîπ |         |    ...                  |                 |
|   |  }                      |         |  }                      |                 |
|   |                         |         |                         |                 |
|   |  $ whoami               |         |  $ whoami               |                 |
|   |  user                   |         |  root  üòà               |                 |
|   +-------------------------+         +-------------------------+                 |
|                                                                                   |
|   ------------------------------------------------------------------------------- |
|                                                                                   |
|   Ëé∑Âæó root ÊùÉÈôêÂêéÔºåÊîªÂáªËÄÖÂèØ‰ª•:                                                   |
|                                                                                   |
|   +-----------------------------------------------------------------------------+ |
|   |                                                                             | |
|   |   ‚Ä¢ ÂÆâË£Ö rootkit / ÂêéÈó®                                                    | |
|   |   ‚Ä¢ ËÆøÈóÆÊâÄÊúâÊñá‰ª∂ÂíåÊï∞ÊçÆ                                                     | |
|   |   ‚Ä¢ ‰øÆÊîπÁ≥ªÁªüÈÖçÁΩÆ                                                           | |
|   |   ‚Ä¢ Á¶ÅÁî®ÂÆâÂÖ®Êú∫Âà∂                                                           | |
|   |   ‚Ä¢ ÊÑüÊüìÂÖ∂‰ªñÁ≥ªÁªü                                                           | |
|   |   ‚Ä¢ ÂÆåÂÖ®ÊéßÂà∂Êï¥‰∏™Êú∫Âô®                                                       | |
|   |                                                                             | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

### Â®ÅËÉÅ 3ÔºöÊãíÁªùÊúçÂä° (DoS) | Denial of Service

```
+-----------------------------------------------------------------------------------+
|                            ÊîªÂáªÔºöÁ≥ªÁªüÊãíÁªùÊúçÂä°                                     |
|                         Attack: Denial of Service                                 |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ÊîªÂáªÊñπÂºè 1: Êó†ÈôêÂæ™ÁéØ                                                            |
|   +-----------------------------------------------------------------------------+ |
|   |  loop:                                                                      | |
|   |    ja loop          // Êó†Êù°‰ª∂Ë∑≥ËΩ¨Âà∞Ëá™Â∑±                                     | |
|   |  exit               // Ê∞∏ËøúÊâßË°å‰∏çÂà∞                                         | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
|   ÊîªÂáªÊñπÂºè 2: Êó†ÈôêÈÄíÂΩí                                                            |
|   +-----------------------------------------------------------------------------+ |
|   |  func:                                                                      | |
|   |    call func        // Ë∞ÉÁî®Ëá™Â∑±ÔºåÊó†ÈôêÈÄíÂΩí                                   | |
|   |  exit                                                                       | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
|   ------------------------------------------------------------------------------- |
|                                                                                   |
|   ÂêéÊûú:                                                                           |
|                                                                                   |
|   +-----------------------------------------------------------------------------+ |
|   |                                                                             | |
|   |      CPU 0            CPU 1            CPU 2            CPU 3              | |
|   |   +---------+      +---------+      +---------+      +---------+           | |
|   |   | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|           | |
|   |   | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|           | |
|   |   | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|           | |
|   |   | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|      | ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà|           | |
|   |   | 100%    |      | 100%    |      | 100%    |      | 100%    |           | |
|   |   +---------+      +---------+      +---------+      +---------+           | |
|   |                                                                             | |
|   |                    üò± ÊâÄÊúâ CPU ÈÉΩË¢´Âç†Êª°ÔºÅ                                   | |
|   |                                                                             | |
|   |   ‚Ä¢ Á≥ªÁªüÂÆåÂÖ®Êó†ÂìçÂ∫î                                                         | |
|   |   ‚Ä¢ Êó†Ê≥ïÁôªÂΩï                                                               | |
|   |   ‚Ä¢ Êó†Ê≥ïÁªàÊ≠¢ËøõÁ®ã                                                           | |
|   |   ‚Ä¢ Âè™ËÉΩÂº∫Âà∂Êñ≠ÁîµÈáçÂêØ                                                       | |
|   |                                                                             | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

### Â®ÅËÉÅ 4ÔºöÂÜÖÊ†∏Â¥©Ê∫É | Kernel Crash

```
+-----------------------------------------------------------------------------------+
|                            ÊîªÂáªÔºöËß¶ÂèëÂÜÖÊ†∏Â¥©Ê∫É                                     |
|                         Attack: Kernel Crash                                      |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ÊîªÂáªÊñπÂºè 1: Èô§‰ª•Èõ∂                                                              |
|   +-----------------------------------------------------------------------------+ |
|   |  mov r1, 0                                                                  | |
|   |  div r2, r1         // Èô§‰ª•Èõ∂ÔºÅ                                             | |
|   |  exit                                                                       | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
|   ÊîªÂáªÊñπÂºè 2: ÈùûÊ≥ïÂÜÖÂ≠òËÆøÈóÆ                                                        |
|   +-----------------------------------------------------------------------------+ |
|   |  mov r1, 0                                                                  | |
|   |  ldxdw r0, [r1]     // ËØªÂèñÂú∞ÂùÄ 0 (Á©∫ÊåáÈíàËß£ÂºïÁî®)                            | |
|   |  exit                                                                       | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
|   ------------------------------------------------------------------------------- |
|                                                                                   |
|   ÂêéÊûú:                                                                           |
|                                                                                   |
|   +-----------------------------------------------------------------------------+ |
|   |                                                                             | |
|   |   +-----------------------------------------------------------------------+ | |
|   |   |                                                                       | | |
|   |   |   Kernel panic - not syncing: divide error: 0000                      | | |
|   |   |   CPU: 0 PID: 1234 Comm: evil_bpf Tainted: G                          | | |
|   |   |                                                                       | | |
|   |   |   Call Trace:                                                         | | |
|   |   |    <IRQ>                                                              | | |
|   |   |    bpf_prog_run+0x42/0x80                                             | | |
|   |   |    ...                                                                | | |
|   |   |                                                                       | | |
|   |   |   Kernel Offset: 0x1e00000 from 0xffffffff81000000                    | | |
|   |   |   ---[ end Kernel panic - not syncing: divide error ]---              | | |
|   |   |                                                                       | | |
|   |   +-----------------------------------------------------------------------+ | |
|   |                                                                             | |
|   |   üíÄ Á≥ªÁªüÂÆåÂÖ®Â¥©Ê∫ÉÔºåÈúÄË¶ÅÈáçÂêØ                                                | |
|   |                                                                             | |
|   |   ‚Ä¢ Ê≠£Âú®ËøêË°åÁöÑÁ®ãÂ∫èÂÖ®ÈÉ®‰∏¢Â§±                                                 | |
|   |   ‚Ä¢ Êú™‰øùÂ≠òÁöÑÊï∞ÊçÆ‰∏¢Â§±                                                       | |
|   |   ‚Ä¢ Êñá‰ª∂Á≥ªÁªüÂèØËÉΩÊçüÂùè                                                       | |
|   |   ‚Ä¢ ÊúçÂä°‰∏≠Êñ≠                                                               | |
|   |                                                                             | |
|   +-----------------------------------------------------------------------------+ |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## È™åËØÅÂô®ÁöÑÂÆâÂÖ®Ê£ÄÊü• | Verifier Security Checks

È™åËØÅÂô®ÁöÑÂ∑•‰ΩúÂ∞±ÊòØÂú®Á®ãÂ∫èËøêË°å‰πãÂâçÔºå**ËØÅÊòé**ÂÆÉÊòØÂÆâÂÖ®ÁöÑÔºö

```
+-----------------------------------------------------------------------------------+
|                           È™åËØÅÂô®Ê£ÄÊü•Ê∏ÖÂçï                                          |
|                       Verifier Checklist                                          |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|  ‚ï≠-----------------------------------------------------------------------------‚ïÆ  |
|  |                           1. ÂÜÖÂ≠òÂÆâÂÖ®                                       |  |
|  |                           Memory Safety                                     |  |
|  +-----------------------------------------------------------------------------+  |
|  |                                                                             |  |
|  |   ‚úÖ ÊâÄÊúâÂÜÖÂ≠òËÆøÈóÆÂøÖÈ°ªÂú®ÊúâÊïàËåÉÂõ¥ÂÜÖ                                           |  |
|  |      All memory accesses must be within valid bounds                        |  |
|  |                                                                             |  |
|  |   ‚úÖ ÊåáÈíàÂøÖÈ°ªÊåáÂêëÂÖÅËÆ∏ÁöÑÂÜÖÂ≠òÂå∫Âüü                                             |  |
|  |      Pointers must point to allowed memory regions                          |  |
|  |                                                                             |  |
|  |   ‚úÖ Ê†àËÆøÈóÆ: R10-1 Âà∞ R10-512                                               |  |
|  |      Stack access: R10-1 to R10-512                                         |  |
|  |                                                                             |  |
|  |   ‚úÖ Map ËÆøÈóÆ: ÂøÖÈ°ªÂú® value_size ËåÉÂõ¥ÂÜÖ                                     |  |
|  |      Map access: must be within value_size                                  |  |
|  |                                                                             |  |
|  |   ‚úÖ Êï∞ÊçÆÂåÖËÆøÈóÆ: ÂøÖÈ°ªÂú® data Âà∞ data_end ‰πãÈó¥                               |  |
|  |      Packet access: must be between data and data_end                       |  |
|  |                                                                             |  |
|  ‚ï∞-----------------------------------------------------------------------------‚ïØ  |
|                                                                                   |
|  ‚ï≠-----------------------------------------------------------------------------‚ïÆ  |
|  |                           2. Á®ãÂ∫èÁªàÊ≠¢ÊÄß                                     |  |
|  |                       Program Termination                                   |  |
|  +-----------------------------------------------------------------------------+  |
|  |                                                                             |  |
|  |   ‚úÖ Á¶ÅÊ≠¢Êó†ÈôêÂæ™ÁéØ (Èô§Èùû‰ΩøÁî®ÊúâÁïåÂæ™ÁéØ)                                        |  |
|  |      No infinite loops (unless bounded loops)                               |  |
|  |                                                                             |  |
|  |   ‚úÖ ÂêëÂêéË∑≥ËΩ¨ÂøÖÈ°ªÊúâÁªàÊ≠¢Êù°‰ª∂                                                 |  |
|  |      Back edges must have termination conditions                            |  |
|  |                                                                             |  |
|  |   ‚úÖ Êåá‰ª§Êï∞ÈôêÂà∂ (ÈªòËÆ§ 100 ‰∏áÊù°)                                             |  |
|  |      Instruction limit (default 1 million)                                  |  |
|  |                                                                             |  |
|  |   ‚úÖ ÊâÄÊúâË∑ØÂæÑÂøÖÈ°ªÂà∞Ëææ exit                                                  |  |
|  |      All paths must reach exit                                              |  |
|  |                                                                             |  |
|  ‚ï∞-----------------------------------------------------------------------------‚ïØ  |
|                                                                                   |
|  ‚ï≠-----------------------------------------------------------------------------‚ïÆ  |
|  |                           3. Á±ªÂûãÂÆâÂÖ®                                       |  |
|  |                           Type Safety                                       |  |
|  +-----------------------------------------------------------------------------+  |
|  |                                                                             |  |
|  |   ‚úÖ ÊØè‰∏™ÂØÑÂ≠òÂô®ÈÉΩÊúâÊòéÁ°ÆÁöÑÁ±ªÂûã                                               |  |
|  |      Every register has a definite type                                     |  |
|  |                                                                             |  |
|  |   ‚úÖ ÊåáÈíà‰∏çËÉΩÂΩìÊ†áÈáèÁî®‰∫éÁÆóÊúØËøêÁÆó                                             |  |
|  |      Pointers cannot be used as scalars for arithmetic                      |  |
|  |                                                                             |  |
|  |   ‚úÖ Ê†áÈáè‰∏çËÉΩÂΩìÊåáÈíàËß£ÂºïÁî®                                                   |  |
|  |      Scalars cannot be dereferenced as pointers                             |  |
|  |                                                                             |  |
|  |   ‚úÖ ËæÖÂä©ÂáΩÊï∞ÂèÇÊï∞Á±ªÂûãÂøÖÈ°ªÊ≠£Á°Æ                                               |  |
|  |      Helper function argument types must be correct                         |  |
|  |                                                                             |  |
|  |   ‚úÖ ‰∏çÂêåÁ±ªÂûãÁöÑÊåáÈíà‰∏çËÉΩÊ∑∑Áî®                                                 |  |
|  |      Different pointer types cannot be mixed                                |  |
|  |                                                                             |  |
|  ‚ï∞-----------------------------------------------------------------------------‚ïØ  |
|                                                                                   |
|  ‚ï≠-----------------------------------------------------------------------------‚ïÆ  |
|  |                           4. ËµÑÊ∫êÂÆâÂÖ®                                       |  |
|  |                         Resource Safety                                     |  |
|  +-----------------------------------------------------------------------------+  |
|  |                                                                             |  |
|  |   ‚úÖ Ëé∑ÂèñÁöÑÈîÅÂøÖÈ°ªÈáäÊîæ                                                       |  |
|  |      Acquired locks must be released                                        |  |
|  |                                                                             |  |
|  |   ‚úÖ ÂºïÁî®ËÆ°Êï∞ÂøÖÈ°ªÂπ≥Ë°°                                                       |  |
|  |      Reference counts must be balanced                                      |  |
|  |                                                                             |  |
|  |   ‚úÖ Map Êü•ÊâæÁöÑÊåáÈíà‰∏çËÉΩÂú®Á®ãÂ∫èÁªìÊùüÂêéËøòÊúâÊïà                                   |  |
|  |      Map lookup pointers cannot outlive program                             |  |
|  |                                                                             |  |
|  |   ‚úÖ ÊâìÂºÄÁöÑËµÑÊ∫êÂøÖÈ°ªÂÖ≥Èó≠                                                     |  |
|  |      Opened resources must be closed                                        |  |
|  |                                                                             |  |
|  ‚ï∞-----------------------------------------------------------------------------‚ïØ  |
|                                                                                   |
|  ‚ï≠-----------------------------------------------------------------------------‚ïÆ  |
|  |                           5. Êï∞ÂÄºÂÆâÂÖ®                                       |  |
|  |                         Numeric Safety                                      |  |
|  +-----------------------------------------------------------------------------+  |
|  |                                                                             |  |
|  |   ‚úÖ Èô§Êï∞‰∏çËÉΩ‰∏∫Èõ∂                                                           |  |
|  |      Divisor cannot be zero                                                 |  |
|  |                                                                             |  |
|  |   ‚úÖ Áßª‰ΩçÈáèÂøÖÈ°ªÂú®ÊúâÊïàËåÉÂõ¥ÂÜÖ                                                 |  |
|  |      Shift amount must be within valid range                                |  |
|  |                                                                             |  |
|  |   ‚úÖ Êï∞ÁªÑÁ¥¢Âºï‰∏çËÉΩË∂äÁïå                                                       |  |
|  |      Array index cannot be out of bounds                                    |  |
|  |                                                                             |  |
|  |   ‚úÖ Ê∫¢Âá∫Ë°å‰∏∫ÂøÖÈ°ªË¢´Ê≠£Á°ÆÂ§ÑÁêÜ                                                 |  |
|  |      Overflow behavior must be properly handled                             |  |
|  |                                                                             |  |
|  ‚ï∞-----------------------------------------------------------------------------‚ïØ  |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## ÊäΩË±°Ëß£ÈáäÔºöÈ™åËØÅÂô®ÁöÑÂ∑•‰ΩúÂéüÁêÜ | Abstract Interpretation

È™åËØÅÂô®‰ΩøÁî®**ÊäΩË±°Ëß£Èáä**ÔºàAbstract InterpretationÔºâÊäÄÊúØ„ÄÇÁÆÄÂçïÊù•ËØ¥ÔºåÂÆÉ‰∏çÊòØÁúüÁöÑËøêË°åÁ®ãÂ∫èÔºåËÄåÊòØ**Ê®°Êãü**Á®ãÂ∫èÁöÑÊâßË°åÔºåËøΩË∏™ÊØè‰∏™ÂØÑÂ≠òÂô®ÂèØËÉΩÁöÑÂÄºËåÉÂõ¥Ôºö

```
+-----------------------------------------------------------------------------------+
|                         ÂÖ∑‰ΩìÊâßË°å vs ÊäΩË±°ÊâßË°å                                      |
|                     Concrete vs Abstract Execution                                |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|  +-----------------------------------------------------------------------------+  |
|  |                          ÂÖ∑‰ΩìÊâßË°å (ÁúüÊ≠£ËøêË°å)                                |  |
|  |                        Concrete Execution                                   |  |
|  |                                                                             |  |
|  |   ËæìÂÖ•: R1 = 5                                                              |  |
|  |                                                                             |  |
|  |   +-----------------+-----------------------------------------------------+ |  |
|  |   |     Êåá‰ª§         |                  ÂØÑÂ≠òÂô®ÂÄº                           | |  |
|  |   +-----------------+-----------------------------------------------------+ |  |
|  |   |  mov r1, 5      |  R1 = 5                                            | |  |
|  |   |  add r1, 3      |  R1 = 8                                            | |  |
|  |   |  mul r1, 2      |  R1 = 16                                           | |  |
|  |   +-----------------+-----------------------------------------------------+ |  |
|  |                                                                             |  |
|  |   ÁªìÊûú: Áü•ÈÅì R1 = 16 (‰∏Ä‰∏™Á≤æÁ°ÆÂÄº)                                           |  |
|  |                                                                             |  |
|  +-----------------------------------------------------------------------------+  |
|                                                                                   |
|  ------------------------------------------------------------------------------- |
|                                                                                   |
|  +-----------------------------------------------------------------------------+  |
|  |                          ÊäΩË±°ÊâßË°å (È™åËØÅÂô®)                                  |  |
|  |                        Abstract Execution                                   |  |
|  |                                                                             |  |
|  |   ËæìÂÖ•: R1 ‚àà [0, 100] (‰∏Ä‰∏™ËåÉÂõ¥)                                            |  |
|  |                                                                             |  |
|  |   +-----------------+-----------------------------------------------------+ |  |
|  |   |     Êåá‰ª§         |                  ÂØÑÂ≠òÂô®ËåÉÂõ¥                         | |  |
|  |   +-----------------+-----------------------------------------------------+ |  |
|  |   |  mov r1, 5      |  R1 ‚àà [5, 5]         (Á≤æÁ°ÆÂÄº)                      | |  |
|  |   |  add r1, 3      |  R1 ‚àà [8, 8]         (Á≤æÁ°ÆÂÄº)                      | |  |
|  |   |  mul r1, 2      |  R1 ‚àà [16, 16]       (Á≤æÁ°ÆÂÄº)                      | |  |
|  |   +-----------------+-----------------------------------------------------+ |  |
|  |                                                                             |  |
|  |   ÁªìÊûú: Áü•ÈÅì R1 ‚àà [16, 16] (‰∏Ä‰∏™ËåÉÂõ¥ÔºåÊÅ∞Â•ΩÊòØÁ≤æÁ°ÆÂÄº)                         |  |
|  |                                                                             |  |
|  +-----------------------------------------------------------------------------+  |
|                                                                                   |
|  ------------------------------------------------------------------------------- |
|                                                                                   |
|  +-----------------------------------------------------------------------------+  |
|  |                       ÂΩìÊúâÂàÜÊîØÊó∂ÔºåÊäΩË±°ÊâßË°åËøΩË∏™ËåÉÂõ¥                          |  |
|  |                     Branch Handling in Abstract Execution                   |  |
|  |                                                                             |  |
|  |   ËæìÂÖ•: R1 ‚àà [0, 100]                                                       |  |
|  |                                                                             |  |
|  |   ‰ª£Á†Å:                                                                     |  |
|  |     if R1 > 50:                                                             |  |
|  |         // ÂàÜÊîØ A                                                           |  |
|  |     else:                                                                   |  |
|  |         // ÂàÜÊîØ B                                                           |  |
|  |                                                                             |  |
|  |                        +-----------------+                                  |  |
|  |                        |  R1 ‚àà [0, 100]  |                                  |  |
|  |                        |  if R1 > 50     |                                  |  |
|  |                        +--------+--------+                                  |  |
|  |                                 |                                           |  |
|  |                    +------------+------------+                              |  |
|  |                    |                         |                              |  |
|  |                    v                         v                              |  |
|  |         +-----------------+       +-----------------+                       |  |
|  |         |  ÂàÜÊîØ A (Áúü)    |       |  ÂàÜÊîØ B (ÂÅá)    |                       |  |
|  |         | R1 ‚àà [51, 100]  |       | R1 ‚àà [0, 50]   |                       |  |
|  |         | ËåÉÂõ¥Ë¢´Êî∂Á™Ñ!      |       | ËåÉÂõ¥Ë¢´Êî∂Á™Ñ!     |                       |  |
|  |         +-----------------+       +-----------------+                       |  |
|  |                                                                             |  |
|  |   ÂÖ≥ÈîÆÊ¥ûÂØü: Êù°‰ª∂ÂàÜÊîØ‰ºö "ÁªÜÂåñ" ÂØÑÂ≠òÂô®ÁöÑÂèØËÉΩËåÉÂõ¥                              |  |
|  |                                                                             |  |
|  +-----------------------------------------------------------------------------+  |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

### ÂØÑÂ≠òÂô®Áä∂ÊÄÅËøΩË∏™ | Register State Tracking

```
+-----------------------------------------------------------------------------------+
|                           ÂØÑÂ≠òÂô®Áä∂ÊÄÅÁªìÊûÑ                                          |
|                        Register State Structure                                   |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   È™åËØÅÂô®‰∏∫ÊØè‰∏™ÂØÑÂ≠òÂô®Áª¥Êä§‰∏Ä‰∏™Áä∂ÊÄÅ:                                                 |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |                                                                        |      |
|   |  // Êñá‰ª∂: crates/bpf-verifier-core/src/state/reg_state.rs             |      |
|   |                                                                        |      |
|   |  pub struct BpfRegState {                                             |      |
|   |                                                                        |      |
|   |      // -------------------------------------------------------       |      |
|   |      // Á±ªÂûã‰ø°ÊÅØ                                                      |      |
|   |      // -------------------------------------------------------       |      |
|   |                                                                        |      |
|   |      /// ÂØÑÂ≠òÂô®Á±ªÂûã                                                   |      |
|   |      /// ÊòØÊ†áÈáèÔºüÊåáÈíàÔºüËøòÊòØÊú™ÂàùÂßãÂåñÔºü                                 |      |
|   |      reg_type: BpfRegType,                                            |      |
|   |                                                                        |      |
|   |      // -------------------------------------------------------       |      |
|   |      // Ê†áÈáèÂÄºËåÉÂõ¥ (ÂΩì reg_type == Scalar Êó∂)                         |      |
|   |      // -------------------------------------------------------       |      |
|   |                                                                        |      |
|   |      /// Êó†Á¨¶Âè∑ÊúÄÂ∞èÂÄº                                                 |      |
|   |      umin_value: u64,    // ÈªòËÆ§: 0                                  |      |
|   |                                                                        |      |
|   |      /// Êó†Á¨¶Âè∑ÊúÄÂ§ßÂÄº                                                 |      |
|   |      umax_value: u64,    // ÈªòËÆ§: u64::MAX                           |      |
|   |                                                                        |      |
|   |      /// ÊúâÁ¨¶Âè∑ÊúÄÂ∞èÂÄº                                                 |      |
|   |      smin_value: i64,    // ÈªòËÆ§: i64::MIN                           |      |
|   |                                                                        |      |
|   |      /// ÊúâÁ¨¶Âè∑ÊúÄÂ§ßÂÄº                                                 |      |
|   |      smax_value: i64,    // ÈªòËÆ§: i64::MAX                           |      |
|   |                                                                        |      |
|   |      /// ‰ΩçÁ∫ßËøΩË∏™ (Tnum)                                             |      |
|   |      var_off: Tnum,      // ËøΩË∏™ÊØè‰∏Ä‰ΩçÁöÑÁ°ÆÂÆöÊÄß                        |      |
|   |                                                                        |      |
|   |      // -------------------------------------------------------       |      |
|   |      // ÊåáÈíà‰ø°ÊÅØ (ÂΩìÊòØÊåáÈíàÁ±ªÂûãÊó∂)                                     |      |
|   |      // -------------------------------------------------------       |      |
|   |                                                                        |      |
|   |      /// Áõ∏ÂØπ‰∫éÂü∫ÂùÄÁöÑÂÅèÁßª                                             |      |
|   |      off: i32,                                                        |      |
|   |                                                                        |      |
|   |      /// ÊåáÈíà ID (Áî®‰∫éËøΩË∏™ÂêåÊ∫êÊåáÈíà)                                   |      |
|   |      id: u32,                                                         |      |
|   |                                                                        |      |
|   |      /// ÂºïÁî® ID (Áî®‰∫éËµÑÊ∫êËøΩË∏™)                                       |      |
|   |      ref_obj_id: u32,                                                 |      |
|   |                                                                        |      |
|   |      // ... Êõ¥Â§öÂ≠óÊÆµ                                                  |      |
|   |  }                                                                     |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   --------------------------------------------------------------------------      |
|                                                                                   |
|   ÂØÑÂ≠òÂô®Á±ªÂûã (BpfRegType):                                                        |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |                                                                        |      |
|   |   NOT_INIT          Êú™ÂàùÂßãÂåñÔºå‰∏çËÉΩ‰ΩøÁî®                                 |      |
|   |   SCALAR_VALUE      Ê†áÈáèÂÄº (Êï∞Â≠ó)                                      |      |
|   |   PTR_TO_CTX        ÊåáÂêëÁ®ãÂ∫è‰∏ä‰∏ãÊñá                                     |      |
|   |   PTR_TO_STACK      ÊåáÂêëÊ†à                                            |      |
|   |   PTR_TO_MAP_VALUE  ÊåáÂêë Map ÁöÑÂÄº                                     |      |
|   |   PTR_TO_MAP_VALUE_OR_NULL  ÂèØËÉΩ‰∏∫ NULL ÁöÑ Map ÂÄºÊåáÈíà                 |      |
|   |   PTR_TO_PACKET     ÊåáÂêëÁΩëÁªúÂåÖÊï∞ÊçÆ                                    |      |
|   |   PTR_TO_PACKET_END ÊåáÂêëÁΩëÁªúÂåÖÁªìÂ∞æ                                    |      |
|   |   ...               ËøòÊúâÊõ¥Â§öÁ±ªÂûã                                      |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## ÂÆåÊï¥È™åËØÅÁ§∫‰æã | Complete Verification Example

ËÆ©Êàë‰ª¨ÁúãÈ™åËØÅÂô®Â¶Ç‰ΩïÂàÜÊûê‰∏Ä‰∏™ÂÆûÈôÖÁ®ãÂ∫èÔºö

```
+-----------------------------------------------------------------------------------+
|                           È™åËØÅÂô®ÂàÜÊûêÁ§∫‰æã                                          |
|                      Verifier Analysis Example                                    |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   Á®ãÂ∫è: ËæπÁïåÊ£ÄÊü•ÂêéËØªÂèñÊï∞ÁªÑÂÖÉÁ¥†                                                    |
|   Program: Read array element after bounds check                                  |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |  // ËæìÂÖ•:                                                              |      |
|   |  // R1 = Êï∞ÁªÑÊåáÈíà (PTR_TO_MAP_VALUE, size=1024)                        |      |
|   |  // R2 = Á¥¢Âºï (SCALAR, Êú™Áü•ÂÄº)                                         |      |
|   |  // R3 = Êï∞ÁªÑÈïøÂ∫¶ (SCALAR, ÂÄº‰∏∫ 128)                                   |      |
|   |                                                                        |      |
|   |  #0: jge r2, r3, error    // if index >= len, goto error              |      |
|   |  #1: lsh r2, 3            // index *= 8 (ÊØèÂÖÉÁ¥† 8 Â≠óËäÇ)                |      |
|   |  #2: add r1, r2           // ptr += index                             |      |
|   |  #3: ldxdw r0, [r1]       // ËØªÂèñ *ptr                                |      |
|   |  #4: exit                                                             |      |
|   |  error:                                                                |      |
|   |  #5: mov r0, -1                                                       |      |
|   |  #6: exit                                                             |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   --------------------------------------------------------------------------      |
|                                                                                   |
|   È™åËØÅËøáÁ®ã:                                                                       |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |  > ÂàùÂßãÁä∂ÊÄÅ                                                           |      |
|   |  --------------------------------------------------------------------  |      |
|   |  R1: PTR_TO_MAP_VALUE, off=0, size=1024                               |      |
|   |  R2: SCALAR, [0, 2^64-1]    <- ÂÆåÂÖ®Êú™Áü•ÁöÑÁ¥¢Âºï                          |      |
|   |  R3: SCALAR, [128, 128]     <- Êï∞ÁªÑÈïøÂ∫¶ÊòØÂ∏∏Èáè 128                      |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v                                                    |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§ #0: jge r2, r3, error                                         |      |
|   |  --------------------------------------------------------------------  |      |
|   |                                                                        |      |
|   |  Êù°‰ª∂: R2 >= R3 ?                                                     |      |
|   |                                                                        |      |
|   |  ‰∫ßÁîü‰∏§‰∏™ÂàÜÊîØ:                                                         |      |
|   |                                                                        |      |
|   |  +----------------------------+  +----------------------------+       |      |
|   |  | ÂàÜÊîØ A (Ë∑≥ËΩ¨Âà∞ error)      |  | ÂàÜÊîØ B (ÁªßÁª≠ÊâßË°å)          |       |      |
|   |  | Êù°‰ª∂: R2 >= 128            |  | Êù°‰ª∂: R2 < 128             |       |      |
|   |  |                            |  |                            |       |      |
|   |  | R2 ‚àà [128, 2^64-1]        |  | R2 ‚àà [0, 127]  <- Êî∂Á™Ñ!    |       |      |
|   |  |                            |  |                            |       |      |
|   |  | -> ÊâßË°å error Ë∑ØÂæÑ          |  | -> ÁªßÁª≠ÂàÜÊûê...              |       |      |
|   |  | -> ËøîÂõû -1                 |  |                            |       |      |
|   |  | -> Ë∑ØÂæÑÂÆâÂÖ® ‚úì              |  |                            |       |      |
|   |  +----------------------------+  +----------------------------+       |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v  (ÁªßÁª≠ÂàÜÊîØ B)                                      |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§ #1: lsh r2, 3   (R2 = R2 << 3 = R2 * 8)                       |      |
|   |  --------------------------------------------------------------------  |      |
|   |                                                                        |      |
|   |  ‰πãÂâç: R2 ‚àà [0, 127]                                                  |      |
|   |  ‰πãÂêé: R2 ‚àà [0, 1016]    (0*8=0, 127*8=1016)                          |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v                                                    |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§ #2: add r1, r2                                                |      |
|   |  --------------------------------------------------------------------  |      |
|   |                                                                        |      |
|   |  ‰πãÂâç: R1 = PTR_TO_MAP_VALUE, off=0                                   |      |
|   |         R2 ‚àà [0, 1016]                                                |      |
|   |                                                                        |      |
|   |  ‰πãÂêé: R1 = PTR_TO_MAP_VALUE, off ‚àà [0, 1016]                         |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v                                                    |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§ #3: ldxdw r0, [r1]                                            |      |
|   |  --------------------------------------------------------------------  |      |
|   |                                                                        |      |
|   |  ÂÜÖÂ≠òËÆøÈóÆÊ£ÄÊü•:                                                         |      |
|   |                                                                        |      |
|   |  +---------------------------------------------------------------+    |      |
|   |  | R1 ÊòØÊúâÊïàÊåáÈíàÂêó?                                              |    |      |
|   |  | -> ÊòØ! PTR_TO_MAP_VALUE ‚úì                                      |    |      |
|   |  |                                                               |    |      |
|   |  | ËÆøÈóÆËåÉÂõ¥: off + 8 Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖÂêó?                             |    |      |
|   |  | -> off ‚àà [0, 1016]                                             |    |      |
|   |  | -> off + 8 ‚àà [8, 1024]                                         |    |      |
|   |  | -> 1024 ‚â§ 1024 (map value size)                                |    |      |
|   |  | -> ËæπÁïåÂÜÖ! ‚úì                                                   |    |      |
|   |  +---------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  ÁªìÊûú: R0 = SCALAR, [0, 2^64-1]  (ËØªÂèñÁöÑÂÄº)                           |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v                                                    |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§ #4: exit                                                      |      |
|   |  --------------------------------------------------------------------  |      |
|   |                                                                        |      |
|   |  ËøîÂõû R0 ‚úì                                                            |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   --------------------------------------------------------------------------      |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |                                                                        |      |
|   |   +--------------------------------------------------------------+    |      |
|   |   |                                                              |    |      |
|   |   |   ÊâÄÊúâË∑ØÂæÑÈÉΩÂÆâÂÖ®ÔºÅÁ®ãÂ∫èÈÄöËøáÈ™åËØÅ ‚úì‚úì‚úì                           |    |      |
|   |   |                                                              |    |      |
|   |   +--------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## È™åËØÅÂô®Â¶Ç‰ΩïÊãíÁªù‰∏çÂÆâÂÖ®Á®ãÂ∫è | How Verifier Rejects Unsafe Programs

### ‰æã1ÔºöÁº∫Â∞ëËæπÁïåÊ£ÄÊü• | Missing Bounds Check

```
+-----------------------------------------------------------------------------------+
|                       È™åËØÅÂ§±Ë¥•Á§∫‰æãÔºöÁº∫Â∞ëËæπÁïåÊ£ÄÊü•                                  |
|                  Verification Failure: Missing Bounds Check                       |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ‰∏çÂÆâÂÖ®Á®ãÂ∫è:                                                                     |
|   +------------------------------------------------------------------------+      |
|   |  // R1 = Êï∞ÁªÑÊåáÈíà, R2 = Á¥¢Âºï (Êú™Ê£ÄÊü•!)                                 |      |
|   |  add r1, r2           // ptr += index (Êú™ÁªèÊ£ÄÊü•ÁöÑÁ¥¢Âºï!)                |      |
|   |  ldxdw r0, [r1]       // ËØªÂèñ *ptr                                    |      |
|   |  exit                                                                  |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   È™åËØÅËøáÁ®ã:                                                                       |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |  > ÂàùÂßãÁä∂ÊÄÅ                                                           |      |
|   |  R1: PTR_TO_MAP_VALUE, off=0, size=1024                               |      |
|   |  R2: SCALAR, [0, 2^64-1]    <- ÂÆåÂÖ®Êú™Áü•!                               |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v                                                    |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§: add r1, r2                                                   |      |
|   |                                                                        |      |
|   |  R2 ‚àà [0, 2^64-1]  (ÂÆåÂÖ®Êú™Áü•)                                         |      |
|   |  R1 = PTR off ‚àà [0, 2^64-1]  <- ÂÅèÁßªÂèØËÉΩË∂ÖÂá∫ËåÉÂõ¥!                      |      |
|   +------------------------------------------------------------------------+      |
|                              |                                                    |
|                              v                                                    |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§: ldxdw r0, [r1]                                               |      |
|   |                                                                        |      |
|   |  ÂÜÖÂ≠òËÆøÈóÆÊ£ÄÊü•:                                                         |      |
|   |                                                                        |      |
|   |  +---------------------------------------------------------------+    |      |
|   |  |                                                               |    |      |
|   |  |  ËÆøÈóÆËåÉÂõ¥: off + 8 Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖÂêó?                            |    |      |
|   |  |                                                               |    |      |
|   |  |  -> off ‚àà [0, 2^64-1]                                          |    |      |
|   |  |  -> off + 8 ‚àà [8, 2^64-1]  <- ÂèØËÉΩÂ∑®Â§ß!                        |    |      |
|   |  |  -> 2^64-1 > 1024 (map value size)                             |    |      |
|   |  |                                                               |    |      |
|   |  |  +-------------------------------------------------------+   |    |      |
|   |  |  |  ‚ùå ÈîôËØØ: Êó†Ê≥ïËØÅÊòéËÆøÈóÆÂú®ËæπÁïåÂÜÖ!                        |   |    |      |
|   |  |  |                                                       |   |    |      |
|   |  |  |  off ÂèØËÉΩÊòØ‰ªª‰ΩïÂÄºÔºåÂåÖÊã¨Ë∂ÖÂá∫ 1024 ÁöÑÂÄº                 |   |    |      |
|   |  |  +-------------------------------------------------------+   |    |      |
|   |  |                                                               |    |      |
|   |  +---------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  +--------------------------------------------------------------+    |      |
|   |  |  È™åËØÅÂ§±Ë¥•ÔºÅÁ®ãÂ∫èË¢´ÊãíÁªù„ÄÇ                                      |    |      |
|   |  |                                                              |    |      |
|   |  |  ÈîôËØØ‰ø°ÊÅØ:                                                   |    |      |
|   |  |  "R1 unbounded memory access, off=[0, 2^64-1]"               |    |      |
|   |  +--------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

### ‰æã2ÔºöÊó†ÈôêÂæ™ÁéØ | Infinite Loop

```
+-----------------------------------------------------------------------------------+
|                        È™åËØÅÂ§±Ë¥•Á§∫‰æãÔºöÊó†ÈôêÂæ™ÁéØ                                     |
|                   Verification Failure: Infinite Loop                             |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ‰∏çÂÆâÂÖ®Á®ãÂ∫è:                                                                     |
|   +------------------------------------------------------------------------+      |
|   |  loop:                                                                 |      |
|   |    mov r0, 1                                                           |      |
|   |    ja loop           // Êó†Êù°‰ª∂Ë∑≥Âõû loop!                               |      |
|   |  exit                // Ê∞∏ËøúÊâßË°å‰∏çÂà∞                                   |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   È™åËØÅËøáÁ®ã:                                                                       |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |  > ÊéßÂà∂ÊµÅÂàÜÊûê                                                         |      |
|   |                                                                        |      |
|   |  Ê£ÄÊµãÂà∞ÂêëÂêéË∑≥ËΩ¨ (back edge):                                           |      |
|   |                                                                        |      |
|   |     +------------------------------------------------------------+    |      |
|   |     |                                                            |    |      |
|   |     |   #0: loop: mov r0, 1    <-----------------------------+  |    |      |
|   |     |          |                                             |  |    |      |
|   |     |          v                                             |  |    |      |
|   |     |   #1: ja loop ------------------------------------------+  |    |      |
|   |     |                           ÂêëÂêéË∑≥ËΩ¨!                        |    |      |
|   |     |                                                            |    |      |
|   |     |   #2: exit               (‰∏çÂèØËææ)                          |    |      |
|   |     |                                                            |    |      |
|   |     +------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  ÈóÆÈ¢òÂàÜÊûê:                                                             |      |
|   |                                                                        |      |
|   |  +---------------------------------------------------------------+    |      |
|   |  |                                                               |    |      |
|   |  |  ‚Ä¢ Êåá‰ª§ #1 (ja loop) Ë∑≥ËΩ¨Âà∞Êåá‰ª§ #0                            |    |      |
|   |  |  ‚Ä¢ ÂÅèÁßª = -1 (ÂêëÂêéË∑≥)                                         |    |      |
|   |  |  ‚Ä¢ ËøôÊòØÊó†Êù°‰ª∂Ë∑≥ËΩ¨ÔºåÊ≤°ÊúâÁªàÊ≠¢Êù°‰ª∂                               |    |      |
|   |  |  ‚Ä¢ Âæ™ÁéØÊ∞∏Ëøú‰∏ç‰ºöÁªìÊùü!                                          |    |      |
|   |  |                                                               |    |      |
|   |  +---------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  È™åËØÅÂô®ËßÑÂàô:                                                           |      |
|   |                                                                        |      |
|   |  +---------------------------------------------------------------+    |      |
|   |  |  1. ÁÆÄÂçïÁöÑÂêëÂêéË∑≥ËΩ¨ -> ÊãíÁªù                                     |    |      |
|   |  |  2. Èô§Èùû‰ΩøÁî®ÊúâÁïåÂæ™ÁéØ (bounded loop)                           |    |      |
|   |  |  3. ÊàñËÄÖÊòØËø≠‰ª£Âô®Ê®°Âºè (bpf_iter)                               |    |      |
|   |  |  4. ÊàñËÄÖ‰ΩøÁî® may_goto (Linux 6.x+)                            |    |      |
|   |  +---------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  +--------------------------------------------------------------+    |      |
|   |  |  ‚ùå ÈîôËØØ: Ê£ÄÊµãÂà∞ÂèØËÉΩÁöÑÊó†ÈôêÂæ™ÁéØ!                              |    |      |
|   |  |                                                              |    |      |
|   |  |  È™åËØÅÂ§±Ë¥•ÔºÅÁ®ãÂ∫èË¢´ÊãíÁªù„ÄÇ                                      |    |      |
|   |  |                                                              |    |      |
|   |  |  ÈîôËØØ‰ø°ÊÅØ:                                                   |    |      |
|   |  |  "back-edge from insn 1 to 0"                                |    |      |
|   |  +--------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

### ‰æã3ÔºöÈô§‰ª•Èõ∂ | Division by Zero

```
+-----------------------------------------------------------------------------------+
|                        È™åËØÅÂ§±Ë¥•Á§∫‰æãÔºöÈô§‰ª•Èõ∂                                       |
|                   Verification Failure: Division by Zero                          |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ‰∏çÂÆâÂÖ®Á®ãÂ∫è:                                                                     |
|   +------------------------------------------------------------------------+      |
|   |  // R2 ÂèØËÉΩÊòØ‰ªª‰ΩïÂÄºÔºåÂåÖÊã¨ 0                                            |      |
|   |  div r1, r2           // R1 /= R2                                      |      |
|   |  exit                                                                  |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   È™åËØÅËøáÁ®ã:                                                                       |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |  > Êåá‰ª§: div r1, r2                                                   |      |
|   |                                                                        |      |
|   |  R2 ÁöÑÁä∂ÊÄÅ:                                                            |      |
|   |  +---------------------------------------------------------------+    |      |
|   |  |  R2: SCALAR                                                   |    |      |
|   |  |  umin_value = 0        <-- ÊúÄÂ∞èÂÄºÊòØ 0!                       |    |      |
|   |  |  umax_value = 2^64-1                                          |    |      |
|   |  +---------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  Èô§Ê≥ïÊ£ÄÊü•:                                                             |      |
|   |  +---------------------------------------------------------------+    |      |
|   |  |                                                               |    |      |
|   |  |  R2 ÂèØËÉΩ‰∏∫ 0 Âêó?                                              |    |      |
|   |  |                                                               |    |      |
|   |  |  -> umin_value = 0                                             |    |      |
|   |  |  -> ÊòØÁöÑÔºåR2 ÂèØËÉΩ‰∏∫ 0!                                         |    |      |
|   |  |                                                               |    |      |
|   |  +---------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   |  +--------------------------------------------------------------+    |      |
|   |  |  ‚ùå ÈîôËØØ: Èô§Êï∞ÂèØËÉΩ‰∏∫Èõ∂!                                      |    |      |
|   |  |                                                              |    |      |
|   |  |  È™åËØÅÂ§±Ë¥•ÔºÅÁ®ãÂ∫èË¢´ÊãíÁªù„ÄÇ                                      |    |      |
|   |  |                                                              |    |      |
|   |  |  ÈîôËØØ‰ø°ÊÅØ:                                                   |    |      |
|   |  |  "div by zero"                                               |    |      |
|   |  +--------------------------------------------------------------+    |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   --------------------------------------------------------------------------      |
|                                                                                   |
|   ‰øÆÂ§çÊñπÊ≥ï:                                                                       |
|   +------------------------------------------------------------------------+      |
|   |  jeq r2, 0, error     // ÂÖàÊ£ÄÊü• R2 ÊòØÂê¶‰∏∫ 0                            |      |
|   |  div r1, r2           // Áé∞Âú® R2 ‚àà [1, 2^64-1]ÔºåÂÆâÂÖ®!                  |      |
|   |  exit                                                                  |      |
|   |  error:                                                                |      |
|   |    mov r0, -1                                                          |      |
|   |    exit                                                                |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## È™åËØÅÁöÑ‰ª£‰ª∑‰∏é‰ºòÂåñ | Cost of Verification

```
+-----------------------------------------------------------------------------------+
|                             Ë∑ØÂæÑÁàÜÁÇ∏ÈóÆÈ¢ò                                          |
|                        Path Explosion Problem                                     |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   È™åËØÅÂô®ÈúÄË¶ÅÈÅçÂéÜÁ®ãÂ∫èÁöÑÊâÄÊúâÂèØËÉΩË∑ØÂæÑ:                                               |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |                                                                        |      |
|   |   if (cond1) { ... }    // 2 Êù°Ë∑ØÂæÑ                                   |      |
|   |   if (cond2) { ... }    // √ó 2 = 4 Êù°Ë∑ØÂæÑ                             |      |
|   |   if (cond3) { ... }    // √ó 2 = 8 Êù°Ë∑ØÂæÑ                             |      |
|   |   if (cond4) { ... }    // √ó 2 = 16 Êù°Ë∑ØÂæÑ                            |      |
|   |   ...                                                                  |      |
|   |   if (condN) { ... }    // √ó 2 = 2^N Êù°Ë∑ØÂæÑ!                          |      |
|   |                                                                        |      |
|   |   Â¶ÇÊûúÊúâ 30 ‰∏™ÂàÜÊîØ: 2^30 ‚âà 10 ‰∫øÊù°Ë∑ØÂæÑ!                                |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   Ë∑ØÂæÑÁàÜÁÇ∏ÂèØËßÜÂåñ:                                                                 |
|                                                                                   |
|        if1                                                                        |
|         |                                                                         |
|      +--+--+                                                                      |
|      v     v                                                                      |
|     if2   if2         2 Êù°Ë∑ØÂæÑ                                                    |
|      |     |                                                                      |
|   +--+--+ ++--+                                                                   |
|   v  v  v v  v                                                                    |
|   if3... if3...       4 Êù°Ë∑ØÂæÑ                                                    |
|   ...                                                                             |
|   ...                 8 Êù°Ë∑ØÂæÑ                                                    |
|   ...                 16 Êù°Ë∑ØÂæÑ                                                   |
|   ...                 ...                                                         |
|   ...                 2^N Êù°Ë∑ØÂæÑ!                                                 |
|                                                                                   |
|   --------------------------------------------------------------------------      |
|                                                                                   |
|   Ëß£ÂÜ≥ÊñπÊ°à: Áä∂ÊÄÅÂâ™Êûù (State Pruning)                                              |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |                                                                        |      |
|   |   Ê†∏ÂøÉÊÄùÊÉ≥:                                                            |      |
|   |                                                                        |      |
|   |   Â¶ÇÊûú‰∏§‰∏™Áä∂ÊÄÅ "Á≠â‰ª∑"ÔºåÂè™ÈúÄË¶ÅÈ™åËØÅ‰∏Ä‰∏™!                                |      |
|   |                                                                        |      |
|   |   ‰æãÂ¶Ç:                                                                |      |
|   |                                                                        |      |
|   |   Áä∂ÊÄÅ A: R1 ‚àà [0, 100]  (Â∑≤È™åËØÅ)                                     |      |
|   |   Áä∂ÊÄÅ B: R1 ‚àà [20, 80]  (ÂæÖÈ™åËØÅ)                                     |      |
|   |                                                                        |      |
|   |   Âõ†‰∏∫ [20, 80] ‚äÇ [0, 100]                                            |      |
|   |   ÊâÄ‰ª•Áä∂ÊÄÅ B ÁöÑÊâÄÊúâË°å‰∏∫ÈÉΩË¢´Áä∂ÊÄÅ A Ë¶ÜÁõñ                                 |      |
|   |   -> ÂèØ‰ª•Ë∑≥ËøáÁä∂ÊÄÅ B ÁöÑÈ™åËØÅ!                                            |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
|   È™åËØÅÂô®ÈôêÂà∂:                                                                     |
|                                                                                   |
|   +------------------------------------------------------------------------+      |
|   |                                                                        |      |
|   |   ‚Ä¢ ÊúÄÂ§ö 100 ‰∏áÊù°Êåá‰ª§ (Â∑≤È™åËØÅÁöÑÊÄªÊï∞)                                  |      |
|   |   ‚Ä¢ ÊúÄÂ§ö 1024 ‰∏™Ê†àÂ∏ßÊ∑±Â∫¶                                              |      |
|   |   ‚Ä¢ Á®ãÂ∫èÊúÄÂ§ß 100 ‰∏áÊù°Êåá‰ª§                                             |      |
|   |   ‚Ä¢ ÂµåÂ•óË∞ÉÁî®Ê∑±Â∫¶ÈôêÂà∂                                                  |      |
|   |                                                                        |      |
|   +------------------------------------------------------------------------+      |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## Á´†ËäÇÂ∞èÁªì | Chapter Summary

```
+-----------------------------------------------------------------------------------+
|                                  Êú¨Á´†Ë¶ÅÁÇπ                                         |
|                              Key Takeaways                                        |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   ‰Ω†Áé∞Âú®ÁêÜËß£‰∫Ü:                                                                   |
|                                                                                   |
|   1. ‰∏∫‰ªÄ‰πàÈúÄË¶ÅÈ™åËØÅÂô®                                                             |
|      ‚Ä¢ Èò≤Ê≠¢ÊÅ∂ÊÑè‰ª£Á†ÅËØªÂÜô‰ªªÊÑèÂÜÖÂ≠ò                                                  |
|      ‚Ä¢ Èò≤Ê≠¢ÊùÉÈôêÊèêÂçáÊîªÂáª                                                          |
|      ‚Ä¢ Èò≤Ê≠¢ÊãíÁªùÊúçÂä°ÊîªÂáª                                                          |
|      ‚Ä¢ Èò≤Ê≠¢ÂÜÖÊ†∏Â¥©Ê∫É                                                              |
|                                                                                   |
|   2. È™åËØÅÂô®Ê£ÄÊü•ÁöÑÂÆâÂÖ®Â±ûÊÄß                                                         |
|      ‚Ä¢ ÂÜÖÂ≠òÂÆâÂÖ®: ÊâÄÊúâËÆøÈóÆÂú®ÊúâÊïàËåÉÂõ¥ÂÜÖ                                            |
|      ‚Ä¢ ÁªàÊ≠¢ÊÄß: Á®ãÂ∫è‰∏ÄÂÆö‰ºöÁªìÊùü                                                    |
|      ‚Ä¢ Á±ªÂûãÂÆâÂÖ®: ÊåáÈíàÂíåÊ†áÈáè‰∏çËÉΩÊ∑∑Áî®                                              |
|      ‚Ä¢ ËµÑÊ∫êÂÆâÂÖ®: Ëé∑ÂèñÁöÑËµÑÊ∫êÂøÖÈ°ªÈáäÊîæ                                              |
|      ‚Ä¢ Êï∞ÂÄºÂÆâÂÖ®: Ê≤°ÊúâÈô§Èõ∂Á≠âÈîôËØØ                                                  |
|                                                                                   |
|   3. ÊäΩË±°Ëß£ÈáäÂéüÁêÜ                                                                 |
|      ‚Ä¢ ‰∏çÁúüÁöÑËøêË°åÁ®ãÂ∫èÔºåËÄåÊòØÊ®°ÊãüÊâßË°å                                              |
|      ‚Ä¢ ËøΩË∏™ÂØÑÂ≠òÂô®ÂèØËÉΩÁöÑÂÄºËåÉÂõ¥                                                    |
|      ‚Ä¢ Êù°‰ª∂ÂàÜÊîØ‰ºöÁªÜÂåñËåÉÂõ¥                                                        |
|      ‚Ä¢ ÈÄöËøáËåÉÂõ¥ÂàÜÊûêËØÅÊòéÂÆâÂÖ®ÊÄß                                                    |
|                                                                                   |
|   4. È™åËØÅÁöÑÈôêÂà∂Âíå‰ºòÂåñ                                                             |
|      ‚Ä¢ Ë∑ØÂæÑÁàÜÁÇ∏ÈóÆÈ¢ò                                                              |
|      ‚Ä¢ Áä∂ÊÄÅÂâ™Êûù‰ºòÂåñ                                                              |
|      ‚Ä¢ ÂêÑÁßçËµÑÊ∫êÈôêÂà∂                                                              |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## ÊÄùËÄÉÈ¢ò | Discussion Questions

```
+-----------------------------------------------------------------------------------+
|                                  ÊÄùËÄÉÈ¢ò                                           |
|                           Discussion Questions                                    |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|   1. Â¶ÇÊûúÈ™åËØÅÂô®Â§™‰∏•Ê†ºÔºå‰ºöÊúâ‰ªÄ‰πàÈóÆÈ¢òÔºüÂ¶ÇÊûúÂ§™ÂÆΩÊùæÂë¢Ôºü                               |
|                                                                                   |
|      ÊèêÁ§∫: ËÄÉËôëËØØÊä• (false positive) ÂíåÊºèÊä• (false negative)                      |
|                                                                                   |
|   ----------------------------------------------------------------------------    |
|                                                                                   |
|   2. ‰∏∫‰ªÄ‰πàÈ™åËØÅÂô®Ë¶ÅËøΩË∏™"ËåÉÂõ¥"ËÄå‰∏çÊòØ"Á≤æÁ°ÆÂÄº"Ôºü                                     |
|                                                                                   |
|      ÊèêÁ§∫: ËÄÉËôëËøêË°åÊó∂ËæìÂÖ•ÁöÑ‰∏çÁ°ÆÂÆöÊÄß                                               |
|                                                                                   |
|   ----------------------------------------------------------------------------    |
|                                                                                   |
|   3. "Áä∂ÊÄÅÂâ™Êûù"ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü‰∏∫‰ªÄ‰πàÂÆÉËÉΩÂä†ÈÄüÈ™åËØÅÔºü                                   |
|                                                                                   |
|      ÊèêÁ§∫: ËÄÉËôëÁä∂ÊÄÅÁ©∫Èó¥ÁöÑË¶ÜÁõñÂÖ≥Á≥ª                                                 |
|                                                                                   |
|   ----------------------------------------------------------------------------    |
|                                                                                   |
|   4. È™åËØÅÂô®ËÉΩ‰øùËØÅ 100% ÂÆâÂÖ®ÂêóÔºüÂèØËÉΩÊúâ‰ªÄ‰πàÊºèÊ¥ûÔºü                                   |
|                                                                                   |
|      ÊèêÁ§∫: ËÄÉËôëÈ™åËØÅÂô®Êú¨Ë∫´ÁöÑ bug                                                   |
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

---

## È°πÁõÆ‰ª£Á†ÅÂØπÁÖß | Code Reference

| ÂÜÖÂÆπ | Êñá‰ª∂‰ΩçÁΩÆ |
|------|----------|
| È™åËØÅÂô®‰∏ªÂæ™ÁéØ | `crates/bpf-verifier-core/src/verifier/main_loop.rs` |
| ÂØÑÂ≠òÂô®Áä∂ÊÄÅ | `crates/bpf-verifier-core/src/state/reg_state.rs` |
| ËæπÁïåËøΩË∏™ | `crates/bpf-verifier-core/src/bounds/` |
| ÂÜÖÂ≠òËÆøÈóÆÊ£ÄÊü• | `crates/bpf-verifier-core/src/check/mem.rs` |
| Áä∂ÊÄÅÂâ™Êûù | `crates/bpf-verifier-core/src/analysis/prune.rs` |

---

[‚¨ÖÔ∏è ‰∏ä‰∏ÄÁ´†ÔºöBPF Êåá‰ª§ÈõÜÂÖ•Èó®](02-bpf-instructions.md) | [ËøîÂõûÁõÆÂΩï](00-introduction.md) | [‰∏ã‰∏ÄÁ´†ÔºöÈ°πÁõÆÊû∂ÊûÑÊÄªËßà ‚û°Ô∏è](04-project-architecture.md)
