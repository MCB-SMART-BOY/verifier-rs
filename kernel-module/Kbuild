# SPDX-License-Identifier: GPL-2.0-only
#
# Kbuild file for the BPF Verifier Rust kernel module
#

# Module object
obj-m := bpf_verifier_rs.o

# Source files - only C wrapper
bpf_verifier_rs-y := src/bpf_verifier_mod.o

# Include paths
ccflags-y := -I$(src)/../include -I$(src)/include

# Link with pre-processed Rust library
# The Rust library is built with custom kernel target and processed to remove problematic sections
RUST_OBJ := $(src)/rust_lib_stripped.o
bpf_verifier_rs-y += rust_lib_stripped.o

# Disable objtool for this entire directory
# Rust-generated code uses FMA4 instructions that objtool can't decode
OBJECT_FILES_NON_STANDARD := y
